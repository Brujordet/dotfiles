#! /usr/bin/env bash
dotfiles=$( cd "$( dirname "${BASH_SOURCE[0]}" )"/.. && pwd )
bashrc=$HOME/.bashrc
src_dir=$(cd "$dotfiles/.." && pwd)

config_folder="$HOME"/.config
[[ -d "$config_folder" ]] || mkdir -p "$config_folder"

for file in "$dotfiles"/config/*; do
  link="$config_folder/${file##*/}"
  echo "Creating symlink from $link to $file"
  ln -sfn "$file" "$link" || exit 1
done

if [[ -f $bashrc ]]; then
  mv "$bashrc" "$bashrc.bac" || exit 1
  echo "Moved your old ~/.bashrc to ~/.bashrc.bac"
fi

echo "# Added by install_dotfiles.sh - $(date +"%d/%m/%y %H:%M")" > ~/.bashrc
for file in "$dotfiles"/bash/*; do
  echo "source $file" >> "$bashrc" || exit 1
done

private_bash="$HOME"/.bash_private

if [[ ! -f "$private_bash" ]]; then
  echo "Creating $private_bash for all your personal needs."
  touch "$private_bash"
fi

echo -e "SRC_DIR=$src_dir\nDOTFILES=$dotfiles" >> "$private_bash" || exit 1
echo "source $private_bash" >> "$bashrc" || exit 1

for file in "$dotfiles"/dotfiles/*; do
  link="$HOME/.${file##*/}"
  echo "Creating symlink from $link to $file"
  ln -sfn "$file" "$link" || exit 1
done

echo "Installing SimpleBashPrompt"
[[ -d "$src_dir"/sbp ]] || git clone git@github.com:brujoand/brujoand/sbp.git
"$src_dir"/sbp/install

echo "Sourcing ~/.bashrc in ~/.profile to handle login shells as well."
echo "source $HOME/.bashrc" >> "$HOME"/.bash_profile

echo -e "\nReload the shell for changes to take effect"

