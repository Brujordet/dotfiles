#!/usr/bin/env bash

if ! type brew &>/dev/null; then
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  (crontab -l 2>/dev/null; echo "* 5 * * * /usr/local/bin/brew update && /usr/local/bin/brew cask update > /dev/null") | crontab -
fi

brew update
brew upgrade --all

source brew_config.sh

for tap in "${taps[@]}"; do
  brew tap "$tap"
done

for package in "${packages[@]}"; do
  brew install "$package"
done

for cask in "${casks[@]}"; do
  brew cask install "$casks"
done

ssh_folder="$HOME"/.ssh
[[ -d "$ssh_folder" ]] || mkdir -p "$ssh_folder"

if [[ ! -f "$ssh_folder"/id_rsa ]]; then
  ssh-keygen -N "" -f "$ssh_folder"/id_rsa
fi

brew cleanup
brew cask cleanup

./set_sane_defaults.sh

../bin/install_dotfiles
